// API Configuration
const API_BASE = 'http://localhost:8080/api';

// DOM Elements
const apiStatus = document.getElementById('api-status');
const addToCartBtn = document.getElementById('add-to-cart');
const quantityInput = document.getElementById('quantity');

// Current product data
let currentProduct = null;

// Load products from API
async function loadProducts() {
    try {
        const response = await fetch(`${API_BASE}/products`);
        const products = await response.json();
        
        if (products && products.length > 0) {
            currentProduct = products[0]; // Use first product
            updateProductDisplay(currentProduct);
            apiStatus.innerHTML = '<span style="color: #27ae60;">✅ Connected to Spring Boot API with Real Products!</span>';
        }
    } catch (error) {
        apiStatus.innerHTML = '<span style="color: #e74c3c;">❌ Error loading products: ' + error.message + '</span>';
    }
}

// Update product display with real data
function updateProductDisplay(product) {
    document.querySelector('.product-title').textContent = product.name;
    document.querySelector('.product-description').textContent = product.description;
    document.querySelector('.current-price').textContent = `$${product.price}`;
    document.getElementById('main-product-image').src = product.imageUrl;
}

// Check API Connection
async function checkAPI() {
    try {
        const response = await fetch(`${API_BASE}/health`);
        if (response.ok) {
            console.log('API is connected');
        }
    } catch (error) {
        apiStatus.innerHTML = '<span style="color: #e74c3c;">❌ Cannot connect to API</span>';
    }
}

// Add to Cart Functionality
addToCartBtn.addEventListener('click', async function() {
    if (!currentProduct) {
        alert('No product loaded!');
        return;
    }
    
    const quantity = parseInt(quantityInput.value);
    
    try {
        const response = await fetch(`${API_BASE}/cart/add`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                productId: currentProduct.id,
                productName: currentProduct.name,
                price: currentProduct.price,
                quantity: quantity
            })
        });
        
        if (response.ok) {
            alert(`✅ ${currentProduct.name} added to cart!`);
        } else {
            alert('❌ Failed to add to cart');
        }
    } catch (error) {
        alert('❌ Error: ' + error.message);
    }
});

// Quantity Controls
document.getElementById('increase-qty').addEventListener('click', function() {
    quantityInput.value = parseInt(quantityInput.value) + 1;
});

document.getElementById('decrease-qty').addEventListener('click', function() {
    if (parseInt(quantityInput.value) > 1) {
        quantityInput.value = parseInt(quantityInput.value) - 1;
    }
});

// Image Thumbnails
document.querySelectorAll('.thumbnail').forEach(thumb => {
    thumb.addEventListener('click', function() {
        document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        document.getElementById('main-product-image').src = this.getAttribute('data-image');
    });
});

// Color Options
document.querySelectorAll('.color-option').forEach(option => {
    option.addEventListener('click', function() {
        document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('active'));
        this.classList.add('active');
    });
});

// Initialize
async function initializeApp() {
    await checkAPI();
    await loadProducts();
}

document.addEventListener('DOMContentLoaded', initializeApp);